---
layout: post
title: "Posting JSON Data to an ASP.net MVC 3 Web Application"
date: 2011-08-04
comments: true
tags: [  JavaScript, MVC, ASP.net, Web dev, .Net, jQuery ]
reposts: ["http://www.dotnetcodegeeks.com/2012/01/posting-json-data-to-aspnet-mvc-3-web.html"]
---

<p>The trend in today's web application development goes more and more in the direction of having rich, desktop-like applications. There are numerous examples on the web, just watch out while your navigating around (Google services are always a good place to look for such apps). But also Microsoft has noted that trend and aligns its products in order reduce the pain to code such rich <b>ajax apps</b> to the minimum possible.</p>

<p>
A good example is ASP.net MVC 3. Below is a quick example on how easy it is to establish a data exchange mechanism between a JavaScript web app and an ASP.net MVC 3 web application. In the example I use JSON as the data exchange format as it is most convenient in a JavaScript environment and moreover it tends to be more compact than other formats (i.e. like XML).</p>

Assume to have the following model on the server-side:<br /><pre class="brush:c#">public class Person<br />{<br />    public long Id { get; set; }<br />    public string Firstname { get; set; }<br />    public string Surname { get; set; }<br />    public int Age { get; set; }<br /><br />    public Address Address { get; set; }<br />}<br /><br /><br />public class Address<br />{<br />    public string Street { get; set; }<br />    public string Cap { get; set; }<br />    public string City { get; set; }<br />}<br /></pre>I <b>create a controller that handles a CRUD</b> operation for a <code>Person</code> object.<br /><pre class="brush:c#">public class PersonController : Controller<br />{<br />   [HttpPost]<br />   public JsonResult Create(Person person)<br />   {<br />      return Json(person); //dummy example, just serialize back the received Person object<br />   }<br />}<br /></pre>Note, the <code><a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.jsonresult.aspx">JsonResult</a></code> return type, but most importantly, note the signature of the <code>Create</code> method. Beside the HttpPost it looks like a plain normal method, right? This method is now accessible through the uri <code>/person/create</code>.<br /><br /><b>On the client-side</b> there is a rich JavaScript app, and somewhere a piece of code that posts the data to the server:<br /><pre class="brush:javascript; highlight:[16,17]">var samplePersonObject = {<br />   firstname: "Juri",<br />   surname: "Strumpflohner",<br />   address: {<br />      street: "Via ....",<br />      cap: "39100",<br />      city: "Bolzano (BZ)"<br />   }<br />};<br /><br />var jsonSerialized = JSON.stringify(samplePersonObject);<br /><br />$.ajax({<br />   type: "POST",<br />   url: "/person/create",<br />   dataType: "json",<br />   contentType: "application/json; charset=utf-8",<br />   data: jsonSerialized,<br />   success: function (result){<br />      console.log(result); //log to the console to see whether it worked<br />   },<br />   error: function (error){<br />      alert("There was an error posting the data to the server: " + error.responseText);<br />   }<br />});<br /></pre>The highlighted lines are the most important ones. These have to match with the kind of return and parameter type the Action method on your ASP.net MVC controller assumes.<br /><br /><a href="http://unknownerror.net/2011-05/how-to-use-the-asp-net-mvc3-json-23783">Some blogs</a> specify the necessity of explicitly registering a <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.jsonvalueproviderfactory(VS.98).aspx">JsonValueProviderFactory</a> on your application start like<br /><pre class="brush:c#">protected void Application_Start()<br />{<br />   ...<br />   ValueProviderFactories.Factories.add(new JsonValueProviderFactory());<br />}<br /></pre>On my setup this wasn't necessary as the JsonValueProviderFactory was already registered by default. I didn't verify that in more detail, though.<br /><br />I really like the simplicity of how the communication is established. There is <b>no boilerplate code</b> on the server that maps raw Http request data to the specific server-side entity of interest (although you could also accept a generic FormCollection type). Your JSON object's properties need simply to match the server-side entity's property names. 