---
layout: post
title: "What? Model-View-Controller in JavaScript?"
date: 2011-10-10
comments: true
tags: [  JavaScript, MVC, Design Patterns, Web dev ]
---

<p>At work I'm currently working on a new web architecture composed of a rich client written in JavaScript and an ASP.net MVC server-side backend exposing a REST-like JSON api. An important part of that work is to also train developers on that, quite new way of programming web-apps. <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://advertisements.2291090.n4.nabble.com/file/n3524722/QUESTION.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="200" src="http://advertisements.2291090.n4.nabble.com/file/n3524722/QUESTION.jpg" width="171" /></a></div>And actually, devs are quite surprised when I mention the term MVC and JavaScript in one sentence?</p>

<blockquote>"Ok...I understand the MVC concept now and the benefits are clear..but JavaScript?"</blockquote>I fully understand their doubts or astonishment. That's the problem with JavaScript and web developers. For many years (and even now) JavaScript has been purely used as a scripting language, for quickly hacking in some dynamic behavior in your web application that was mainly rendered by some "fat" (IIS ASP.net / Apache JBoss) server. How did that look like??<br /><pre class="brush:javascript">&lt;html&gt;<br />&lt;head&gt;<br />&lt;script type="text/javascript"&gt;<br />function performAction(){<br />   var dropdown = document.getElementById("myDropdown");<br />   if(dropdown.selectedIndex == .....)<br />       document.getElementById("theDiv").style.display = "none";<br />   ...<br />}<br />&lt;/script&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />   ...<br />   &lt;input type="button" value="doAction" onClick="performAction()"/&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre>Something like this, right? I'm speaking out of experience. That's JavaScript used as a "scripting language", fully procedural, hooked in globally on the window object far away from any best practice or object oriented approach (nor to speak about testability).<br /><br />Enough, let's talk about MVC.<br /><br /><span style="font-size: large;"><b>The "messy", structureless codebase</b></span><br /><pre class="brush:javascript highlight:[5]">function showOutput(){<br />  var name = "Juri";<br />  var age = 26;<br />  <br />  var output = "Hi, my name is <i>" + name + "</i> and I'm <i>" + age + "</i> years old.";<br />  $(".output").html(output);<br />}<br /></pre>and the according HTML page <br /><div style="text-align: right;"><span style="font-size: x-small;"><a href="http://jsbin.com/oyazib/3/edit">http://jsbin.com/oyazib/3/edit</a></span></div><pre class="brush:html highlight:[12]">&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"&gt;&lt;/script&gt;<br />&lt;meta charset=utf-8 /&gt;<br />&lt;title&gt;JS Bin&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />  &lt;div id="view"&gt;<br />    &lt;strong&gt;Output:&lt;/strong&gt;<br />    &lt;div class="output"&gt;&lt;/div&gt;<br />    &lt;input id="btnClickMe" type="button" value="Click me" onClick="showOutput()"/&gt;<br />  &lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre>I guess this is what might seem most familiar to you. The "onClick" event is directly registered on the button (line 12) which invokes a global function "showOutput" which in turn processes the embedded output and sets it to a given div element.<br /><br /><b><span style="font-size: large;">Converting the example to be more MVC-like</span></b><br /><u><b>Step 1: Remove the event registering code from the HTML code.</b></u><br />In a first step we remove the event registering code from the above example s.t. the code looks as follows:<br /><pre class="brush:javascript highlight:[10]">function showOutput(){<br />  var name = "Juri";<br />  var age = 26;<br />  <br />  var output = "Hi, my name is <i>" + name + "</i> and I'm <i>" + age + "</i> years old.";<br />  $(".output").html(output);<br />}<br /><br />$(document).ready(function(){<br />  $("#btnClickMe").click(showOutput);<br />});</pre>and the HTML code doesn't have any knowledge about the JavaScript behind, now. <br /><div style="text-align: right;"><span style="font-size: x-small;"><a href="http://jsbin.com/oyazib/4/edit">http://jsbin.com/oyazib/4/edit</a></span></div><pre class="brush:html">&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"&gt;&lt;/script&gt;<br />&lt;meta charset=utf-8 /&gt;<br />&lt;title&gt;JS Bin&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />  &lt;div id="view"&gt;<br />    &lt;strong&gt;Output:&lt;/strong&gt;<br />    &lt;div class="output"&gt;&lt;/div&gt;<br />    &lt;input id="btnClickMe" type="button" value="Click me"/&gt;<br />  &lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre><u><br /></u><br /><u><b>Step 2: Extracting the model</b></u><br />So far the "model" wasn't really visible but rather represented by the two variables "name" and "age". Let's create a simple JavaScript object that encapsulates this data: <br /><div style="text-align: right;"><span style="font-size: x-small;"><a href="http://jsbin.com/oyazib/5/edit">http://jsbin.com/oyazib/5/edit</a></span></div><pre class="brush:javascript">var Person = function(firstname, age){<br />  this.firstname = firstname;<br />  this.age = age;<br />};<br /><br />function showOutput(){<br />  var aPerson = new Person("Juri", 26);  <br />  <br />  var output = "Hi, my name is <i>" + aPerson.firstname + "</i> and I'm <i>" + aPerson.age + "</i> years old.";<br />  $(".output").html(output);<br />}<br /><br />$(document).ready(function(){<br />  $("#btnClickMe").click(showOutput);<br />});</pre>The HTML code remains unchanged.<br /><br /><u><b>Step 3: Moving the presentation logic where it belongs to</b></u><br />The major thing that still disturbs in the above code is the presentation logic that is encoded in line 9. This is pure presentation logic. To solve this problem we use a templating engine. For simplicity reasons I've chosen <a href="http://api.jquery.com/jquery.tmpl/">jQuery tmpl</a>&nbsp;but there are numerous others like <a href="http://aefxx.com/jquery-plugins/jqote2/">jQote</a> and <a href="http://embeddedjs.com/">EJS templates</a>.<br />First, the view: <br /><pre class="brush:html">&lt;script type="text/x-jquery-tmpl" id="personView"&gt;<br />  Hi, my name is &lt;i&gt;${firstname}&lt;/i&gt; and I'm &lt;i&gt;${age}&lt;/i&gt; old.<br />&lt;/script&gt;</pre>The strange <code>${...}</code> are the jQuery tmpl placeholders. The according JavaScript code now looks as follows: <br /><div style="text-align: right;"><span style="font-size: x-small;"><a href="http://jsbin.com/oyazib/7/edit">http://jsbin.com/oyazib/7/edit</a></span></div><pre class="brush:javascript highlight:[9,10]">var Person = function(firstname, age){<br />  this.firstname = firstname;<br />  this.age = age;<br />};<br /><br />function showOutput(){<br />  var aPerson = new Person("Juri", 26);  <br />  <br />  var output = $("#personView").tmpl(aPerson);<br />  $(".output").html(output);<br />}<br /><br />$(document).ready(function(){<br />  $("#btnClickMe").click(showOutput);<br />});</pre>Note the highlighted lines 9 and 10. There is no view-related code any more, but rather we invoke jQuery tmpl with the given view and pass in the data. The HTML code remains unchanged, except the jQuery tmpl view which is added at the end of the <code>&lt;head&gt;</code> section. Now that we have the model and the view extracted, where's the controller??<br /><br /><b><u>Step 4: The controller, refining the big picture</u></b><br />The controller is nothing else but the glue that keeps together the model and the view. It knows from where to the fetch the model and which view to use. In fact, it is already present in the JavaScript code that has been shown so far. Have a look at the big picture:<br /><b>The Model:</b><br /><pre class="brush:javascript">var Person = function(firstname, age){<br />  this.firstname = firstname;<br />  this.age = age;<br />};</pre><br /><b>The View:</b><br /><pre class="brush:html">&lt;!DOCTYPE html&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"&gt;&lt;/script&gt;<br />&lt;script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"&gt;&lt;/script&gt;<br />&lt;meta charset=utf-8 /&gt;<br />&lt;title&gt;JS Bin&lt;/title&gt;<br /><br />&lt;script type="text/x-jquery-tmpl" id="personView"&gt;<br />  Hi, my name is &lt;i&gt;${firstname}&lt;/i&gt; and I'm &lt;i&gt;${age}&lt;/i&gt; old.<br />&lt;/script&gt;<br />  <br />&lt;/head&gt;<br />&lt;body&gt;<br />  &lt;div id="view"&gt;<br />    &lt;strong&gt;Output:&lt;/strong&gt;<br />    &lt;div class="output"&gt;&lt;/div&gt;<br />    &lt;input id="btnClickMe" type="button" value="Click me"/&gt;<br />  &lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre><br /><b>The Controller:</b><br /><pre class="brush:javascript">$(document).ready(function(){<br />  $("#btnClickMe").click(function(){<br />    var aPerson = new Person("Juri", 26);  <br />  <br />    var output = $("#personView").tmpl(aPerson);<br />    $(".output").html(output); <br />  });<br />});</pre><br /><b><span style="font-size: large;">Conclusion</span></b><br />The example mentioned in this post is very basic and simple but still, I think it perfectly reflects what the MVC pattern is about and how a possible implementation in JavaScript could look like.<br />Obviously this is a simple example with the purpose of understanding the concepts. In a real-world application you would probably rely on the numerous JavaScript MVC frameworks that are available.<br /><br /><span style="font-size: large;"><b>Now for the advanced among you</b></span><br />For the more JavaScript-literate guys among you, I'd even go a step further and make the MVC model more clear by extracting the controller's logic into a reusable jQuery plugin. <br />The controller is now encapsulated into a jQuery plugin which takes a view and a model to handle. <br /><pre class="brush:javascript">//Controller<br />(function($){<br />  <br />  $.fn.personcontroller = function(model){ <br /><br />    //register events<br />    $("input[type=button]", this).click(function(){ <br />      var output = $("#personView").tmpl(model);<br />      $(".output").html(output); <br />    });<br />    <br />  };<br />  <br />})(jQuery);<br /></pre>Finally, there is the application entry code which hooks up the controller: <br /><pre class="brush:javascript">//Main of the "application"<br />$(document).ready(function(){<br />  var aPerson = new Person("Juri", 26);<br />  $("#view").personcontroller(aPerson);<br />});</pre>I guess now the separation is perfectly visible. The controller registers itself on a view where it hooks on the click event and visualizes the model that has been passed.<br /><br />The live code can be found here:&nbsp;<a href="http://jsbin.com/oyazib/11/edit">http://jsbin.com/oyazib/latest/edit</a>