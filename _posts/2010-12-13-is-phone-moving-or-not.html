---
layout: post
title: "Is the Phone Moving or Not?"
date: 2010-12-13
comments: true
tags: [  Java, mobile dev, Android ]
---

<p>It is really amazing to see how mobile devices evolved over the past years. I mean, I'm 25 now, and I remember my first phone, a Nokia 3210. I was that happy to get it, and you couldn't just <b>phone</b>, you could also send tiny text messages ;).&nbsp;Nowadays children would probably laugh seing such a phone, given the new smartphones which currently hit the market.</p>

Obviously, as a developer, what's most interesting about all that stuff is to code for these devices. It really gives you endless new opportunities to write amazing apps which you can carry around in your pocket :). Not only is the computing power increasing with every new devices which comes out, but also the amount of sensors such a device has build in is so cool: Bluetooth (obviously) with which you can really do nice stuff I'd never have imagined if not writing my current MSc thesis about it, accelerator sensors, orientation sensors etc...<br /><br /><a name='more'></a><br />I mean this is mostly geeky stuff, but how cool is it to write a small app which "knows" whether the phone is moving or laying somewhere on the table? In Android this turns out to be pretty simple..<br /><table align="center" border="0"><tbody><tr> <td><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/_tF6XjsUy87k/TQE-vhsPnNI/AAAAAAAACyM/1z1Nm-ynBxM/s1600/android_not_moving.png" imageanchor="1" rel="zoombox" style="margin-left: auto; margin-right: auto;"><img border="0" height="320" src="http://4.bp.blogspot.com/_tF6XjsUy87k/TQE-vhsPnNI/AAAAAAAACyM/1z1Nm-ynBxM/s320/android_not_moving.png" width="213" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Not moving</td></tr></tbody></table></td> <td><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/_tF6XjsUy87k/TQE-vDg8WuI/AAAAAAAACyI/3wQCbLSrWlM/s1600/android_moving.png" imageanchor="1" rel="zoombox" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/_tF6XjsUy87k/TQE-vDg8WuI/AAAAAAAACyI/3wQCbLSrWlM/s320/android_moving.png" width="213" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">In movement</td></tr></tbody></table></td> </tr></tbody></table>Android has a SensorManager which gives you access to the accelerometer sensor. Having that, you can read the according device's x, y and z coordinates.<br /><pre class="brush:java">import android.hardware.Sensor;<br />import android.hardware.SensorEvent;<br />import android.hardware.SensorEventListener;<br />import android.hardware.SensorManager;<br /><br />public class TestActivity extends Activity implements SensorEventListener {<br />   private SensorManager mgr;<br />   private Sensor sensorAccelerometer;<br />   private long lastUpdate;<br />   private float lastX = 0.5f;<br />   private float lastY = 0.5f;<br />   private float lastZ = 0.9f;<br />  <br />   @Override<br />   protected void onCreate(Bundle savedInstanceState) {<br />      super.onCreate(savedInstanceState);<br />      setActionBarContentView(R.layout.testactivity);<br />  <br />      mgr = (SensorManager)getSystemService(SENSOR_SERVICE);<br />      sensorAccelerometer = mgr.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);<br />   }<br /> <br />   @Override<br />   protected void onResume() {<br />      super.onResume();<br />      mgr.registerListener(this, sensorAccelerometer, SensorManager.SENSOR_DELAY_UI);<br />   }<br /> <br />   @Override<br />   protected void onPause() {<br />      super.onPause();<br />      mgr.unregisterListener(this);<br />   }<br /><br />   @Override<br />   public void onAccuracyChanged(Sensor sensor, int accuracy) {<br />      // TODO Auto-generated method stub<br />   }<br /><br />   @Override<br />   public void onSensorChanged(SensorEvent event) {<br />      if(event.sensor.getType() == Sensor.TYPE_ACCELEROMETER){<br />         long currTime = System.currentTimeMillis();<br />   <br />         if((currTime - lastUpdate) &gt; 1000){ //just scan every second<br />            lastUpdate = currTime;<br />     <br />            float xAxis = event.values[SensorManager.DATA_X];<br />            float yAxis = event.values[SensorManager.DATA_Y];<br />            float zAxis = event.values[SensorManager.DATA_Z];<br />    <br />            String comment = inMovement(xAxis, yAxis, zAxis) ? "not moving" : "in movement";<br />    <br />            publishValues(xAxis, yAxis, zAxis, comment);<br />    <br />            lastX = xAxis;<br />            lastY = yAxis;<br />            lastZ = zAxis;<br />         }  <br />      }<br />   }<br /><br />   private boolean inMovement(float xAxis, float yAxis, float zAxis) {<br />      final float tolerance = 0.5f;<br />  <br />      if(Math.abs(xAxis - lastX) &lt;= tolerance &amp;&amp; Math.abs(yAxis - lastY) &lt;= tolerance &amp;&amp; Math.abs(zAxis - lastZ)&lt;=tolerance){<br />         return true;<br />      }else<br />         return false;<br />      }<br /><br />      private void publishValues(float x, float y, float z, String comment) {<br />         TextView mainText =(TextView)findViewById(R.id.textView);<br />  <br />         mainText.setText("X: " + x + " - Y: " + y + " - Z: " + z + "\nComment: " + comment);<br />      }<br />}</pre>Don't look at clean code here, alright ;)? It's just a prototype. I'm not going to describe it in detail, it's quite simple and you'll find it out.<br /><br />By the way, the SensorManager is also documented on <a href="http://developer.android.com/reference/android/hardware/SensorManager.html">developer.android.com</a>. But pay attention at the code there. There are some errors in there like the "," after the class isn't valid Java syntax<br /><pre class="brush:java; highlight:[1]">public class SensorActivity extends Activity, implements SensorEventListener {<br />     private final SensorManager mSensorManager;<br />     private final Sensor mAccelerometer;<br /></pre>and retrieving the SensorManager in the Activity's constructor won't work because it is yet available at that time. You better create it in the <code>onCreate(...)</code> ;).