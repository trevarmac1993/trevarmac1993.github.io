---
layout: post
title: "Smiley-support for blog-entries"
date: 2007-02-13
comments: true
tags: [  JavaScript ]
---

I like it to add smileys to my posts, since I find they make it much more personally. On my old homepage I put smileys by simply inserting the according IMG HTML tag and <pre class="code">function getElementsByClassName(class_name){<br />var all_obj,ret_obj=new Array(),j=0,teststr;<br />if(document.all)all_obj=document.all;<br />else if(document.getElementsByTagName &&amp; !document.all)all_obj=document.getElementsByTagName("*");<br />for(i=0;i&lt;all_obj.length;i++){<br />if(all_obj[i].className.indexOf(class_name)!=-1){<br /> teststr=","+all_obj[i].className.split(" ").join(",")+",";<br /> if(teststr.indexOf(","+class_name+",")!=-1){<br />  ret_obj[j]=all_obj[i];<br />  j++;<br /> }<br />}<br />}<br />return ret_obj;<br />}</pre><br />Having understood these things, the script itself is no more difficult. The logic of the script is basically to search in the regions with a certain classname for the socalled "smiley patterns" and to replace them with the according IMG HTML code. So a first version of the script could look as follows:<br /><pre class="code">&lt;script type="text/javascript"><br />//&lt;![CDATA[<br />function createSmilies(){<br />var post = getElementsByClassName("post-body");<br />post.innerHTML = <b>post.innerHTML.replace</b>(/\s:\)/, ' &lt;img src="http://i158.photobucket.com/albums/t90/kito85/smilies/smile.gif" class="smilie"/> ');<br />}<br /><br />function <b>getElementsByClassName(class_name)</b>{<br />var all_obj,ret_obj=new Array(),j=0,teststr;<br />if(document.all)all_obj=document.all;<br />else if(document.getElementsByTagName &&amp; !document.all)all_obj=document.getElementsByTagName("*");<br />for(i=0;i&lt;all_obj.length;i++){<br />if(all_obj[i].className.indexOf(class_name)!=-1){<br />  teststr=","+all_obj[i].className.split(" ").join(",")+",";<br />  if(teststr.indexOf(","+class_name+",")!=-1){<br />      ret_obj[j]=all_obj[i];<br />      j++;<br />  }<br />}<br />}<br />return ret_obj;<br />}<br />//]]><br />&lt;/script><br /></pre><br />To access the HTML code of the region, the property <span class="code">innerHTML</span> is used. The <span class="code">replace()</span> function takes two parameters. The first one is a regular expression and the second parameter is the string which replaces the string in the html-code that matches the regular expression. The problem with the above version of the script is that it doesn't take into consideration the possibility that there may be several regions that have the same classname associated. Therefore the code has to be changed as follows:<br /><pre class="code">&lt;script type="text/javascript"><br />//&lt;![CDATA[<br />function createSmilies(){<br />var post = getElementsByClassName("post-body");<br />for(var i=0;i&lt;post.length;i++){<br /><b>post[i]</b>.innerHTML = <b>post[i]</b>.innerHTML.replace(/\s:\)/, ' &lt;img src="http://www2.blogger.com/..." class="smilie" /> ');<br />...<br />}<br />}<br /><br />function getElementsByClassName(class_name){<br />...<br />}<br />//]]><br />&lt;/script><br /></pre><br />In this way the code iterates over all regions with the given classname.<br /><br /><span style="font-weight: bold;font-size:130%;" >Usage</span><br />You can download a working sample <a href="http://juri.strumpflohner.googlepages.com/smileyscript.zip">here</a> and modify it according to your needs.<br />Tip: You have to host your smiley images somewhere. I currently host it on <a href="http://photobucket.com/">Photobucket</a>. If you have a Google account you may also think to put them on your <a href="http://pages.google.com/">Google Page</a>.