---
layout: post
title: "Law of Demeter: Nice metaphor"
date: 2009-09-22
comments: true
tags: [  Best Practices, testing, Software Design ]
---

I just came across a nice metaphor for explaining the Law of Demeter. For those of you that didn't yet hear about it, the Law of Demeter is a object oriented design principle. A guideline basically which leads to nice and testable OO code, but <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">Wiki</a> will tell you more.<br /><br />The metaphor is the following:<br /><blockquote>Imagine you are in a store and the item you are purchasing is $25.<br /><br />Do you give the clerk $25?<br /><br />Or do you give him the wallet and let him/her retrieve the $25?<br /></blockquote>Intuitive I guess :) . The same actually holds for the design of objects. Consider this example:<br /><pre class="prettyprint">class Goods{<br />   AccountReceivable ar; <br /><br />   void purchase(Customer customer){<br />      Money m = customer.getWallet().getMoney();<br />      ar.recordSale(this,m);<br />   }<br /><br />}<br /></pre><br />You still may not see the problem but it'll come out when testing the purchase method. For doing so the following code has to be instantiated:<br /><pre class="prettyprint">class GoodsTest{<br /><br />   void purchaseTest(){<br />      AccountReceivable ar = new MockAR();<br />      Goods goods = new Goods(ar);<br />      Money money = new Money(25, USD);<br />      Wallet wallet = new Wallet(money);<br />      Customer customer = new Customer(wallet);<br /><br />      //finally<br />      g.purchase(customer);<br />      assertEquals(25, ar.getSales());<br />   }<br />}<br /></pre>Looks horrible, doesn't it?<br /><br />Instead, when following the Law of Demeter, we would design it as follows:<br /><pre class="prettyprint">class Goods{<br />   AccountReceivable ar; <br /><br />   void purchase(Money money){<br />      ar.recordSale(this,money);<br />   }<br /><br />}<br /></pre>and test it like<br /><pre class="prettyprint">class GoodsTest{<br /><br />   void purchaseTest(){<br />      AccountReceivable ar = new MockAR();<br />      Goods goods = new Goods(ar);<br />      <br />      g.purchase(new Money(25, USD));<br />      assertEquals(25, ar.getSales());<br />   }<br />}<br /></pre>Looks already much nicer and much more correct in my opinion. Why should the Goods class know where the money comes from?? It just shouldn't care about that.<br /><br />In my eyes this is a really nice explanation of the Law of Demeter and moreover it shows how unit testing uncovers flaws in your code. When unit testing gets hard or impossible is a big indication of problems in your code. That's why a lot of people don't like unit testing...just because they're writing untestable code.<br /><br />I've another draft post in <a href="http://blog.js-development.com/">my blog list</a> about how you can improve testability and software design by using dependency injection. It's very tightly coupled to this topic here. I just did not yet find the time to finish it and btw...now I really have to continue to study for my Statistics exam this Friday...